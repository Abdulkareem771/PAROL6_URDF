# Controller Manager Configuration for PAROL6
# Day 1: SIL (Software-in-the-Loop) Validation
#
# Purpose: Configure ros2_control controller manager and controllers
# - Update rate: 25 Hz (conservative, proven safe - see implementation plan)
# - Controllers: joint_state_broadcaster + joint_trajectory_controller

controller_manager:
  ros__parameters:
    # Update rate: Commands to hardware at 25 Hz
    # This is read()/write() call frequency
    # Conservative start - can increase to 50Hz after binary migration
    update_rate: 25  # Hz
    
    # List of controllers to load
    # Note: These are loaded but not necessarily started
    # Use: ros2 control list_controllers to see status
    joint_state_broadcaster:
      type: joint_state_broadcaster/JointStateBroadcaster

    parol6_arm_controller:
      type: joint_trajectory_controller/JointTrajectoryController

# ============================================================================
# Joint State Broadcaster
# ============================================================================
# Publishes /joint_states topic for RViz, MoveIt, etc.
# Reads from hardware state interfaces (position + velocity)

joint_state_broadcaster:
  ros__parameters:
    # No additional parameters needed - uses all available joints

# ============================================================================
# Joint Trajectory Controller
# ============================================================================
# Receives FollowJointTrajectory action goals from MoveIt
# Sends position commands to hardware interface

parol6_arm_controller:
  ros__parameters:
    # Joint names (must match URDF and hardware interface)
    joints:
      - joint_L1
      - joint_L2
      - joint_L3
      - joint_L4
      - joint_L5
      - joint_L6
    
    # Command interface: what we send TO hardware
    # For Day 1-3: position only
    # Future: can add velocity, acceleration
    command_interfaces:
      - position
    
    # State interfaces: what we read FROM hardware
    # Position: required for trajectory execution
    # Velocity: optional but recommended for better control
    state_interfaces:
      - position
      - velocity
    
    # Action server configuration
    # MoveIt connects to: /parol6_arm_controller/follow_joint_trajectory
    action_monitor_rate: 20.0  # Hz - how often to check goal status
    
    # Trajectory execution tolerances
    # These determine when a trajectory point is "reached"
    constraints:
      stopped_velocity_tolerance: 0.01  # rad/s - joint considered stopped
      goal_time: 0.0  # seconds - 0 = no time limit for reaching goal
      
      # Per-joint goal tolerances
      # During motion: path tolerance (how far from trajectory is OK)
      # At goal: goal tolerance (how close to final position)
      joint_L1:
        trajectory: 0.05  # rad - path following tolerance
        goal: 0.02        # rad - final position tolerance
      joint_L2:
        trajectory: 0.05
        goal: 0.02
      joint_L3:
        trajectory: 0.05
        goal: 0.02
      joint_L4:
        trajectory: 0.05
        goal: 0.02
      joint_L5:
        trajectory: 0.05
        goal: 0.02
      joint_L6:
        trajectory: 0.05
        goal: 0.02
    
    # Feedback publishing
    state_publish_rate: 25.0  # Hz - matches controller update rate
    
    # For trajectory interpolation
    # allow_partial_joints_goal: false means all 6 joints must be in goal
    allow_partial_joints_goal: false
